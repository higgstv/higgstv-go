{
    "swagger": "2.0",
    "info": {
        "description": "Session-based authentication",
        "title": "HiggsTV API Server",
        "termsOfService": "http://swagger.io/terms/",
        "contact": {
            "name": "API Support",
            "url": "http://www.higgstv.com",
            "email": "support@higgstv.com"
        },
        "license": {
            "name": "Apache 2.0",
            "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
        },
        "version": "1.0"
    },
    "host": "localhost:8080",
    "basePath": "/",
    "paths": {
        "/apis/addchannel": {
            "post": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "建立新頻道（需要登入）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "頻道"
                ],
                "summary": "新增頻道",
                "parameters": [
                    {
                        "description": "新增頻道請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.AddChannelRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "需要登入\" example({\"state\":1,\"code\":1})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/addprog": {
            "post": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "在頻道中新增節目（需要登入且為頻道管理員）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "節目"
                ],
                "summary": "新增節目",
                "parameters": [
                    {
                        "description": "新增節目請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.AddProgramRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "需要登入或權限不足\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/change_password": {
            "post": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "修改密碼（需登入）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "認證"
                ],
                "summary": "變更密碼",
                "parameters": [
                    {
                        "description": "變更密碼請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.ChangePasswordRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "缺少欄位\" example({\"state\":1,\"code\":0})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/delprog": {
            "post": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "刪除節目（可一次刪除多個，需登入，需有權限）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "節目"
                ],
                "summary": "刪除節目",
                "parameters": [
                    {
                        "description": "刪除節目請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.DeleteProgramRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "權限不足\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/forget_password": {
            "post": {
                "description": "請求寄送重設密碼郵件。無論 Email 是否存在，都回成功（安全設計）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "認證"
                ],
                "summary": "忘記密碼",
                "parameters": [
                    {
                        "description": "忘記密碼請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.ForgetPasswordRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "缺少欄位\" example({\"state\":1,\"code\":0})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/getchannel/{id}": {
            "get": {
                "description": "根據頻道 ID 取得頻道詳細資訊",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "頻道"
                ],
                "summary": "取得單一頻道",
                "parameters": [
                    {
                        "type": "string",
                        "description": "頻道 ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "頻道不存在\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/getchannelinfo/{id}": {
            "get": {
                "description": "取得頻道詳細資訊，包含擁有者基本資訊",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "頻道"
                ],
                "summary": "取得頻道資訊（含擁有者）",
                "parameters": [
                    {
                        "type": "string",
                        "description": "頻道 ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "頻道不存在\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/getchannels": {
            "get": {
                "description": "取得公開頻道列表，支援過濾和排序",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "頻道"
                ],
                "summary": "取得頻道列表",
                "parameters": [
                    {
                        "type": "string",
                        "description": "只列出特定使用者的頻道（username）",
                        "name": "user",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "以名稱模糊搜尋",
                        "name": "q",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "是否只顯示有節目的頻道（0/1）",
                        "name": "has_contents",
                        "in": "query"
                    },
                    {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "collectionFormat": "csv",
                        "description": "要排除的頻道類型陣列",
                        "name": "ignore_types",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "排序欄位（例如：last_modified, name）",
                        "name": "sort",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "是否遞減排序（0/1）",
                        "name": "desc",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "分頁起始 index",
                        "name": "start",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "限制筆數",
                        "name": "limit",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "成功回應",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/getownchannels": {
            "get": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "取得當前登入使用者擁有的所有頻道（需要登入），支援 q 和 types[] 過濾",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "頻道"
                ],
                "summary": "取得自己的頻道列表",
                "parameters": [
                    {
                        "type": "string",
                        "description": "關鍵字搜尋（頻道名稱）",
                        "name": "q",
                        "in": "query"
                    },
                    {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "collectionFormat": "csv",
                        "description": "頻道類型陣列（例如：default,unclassified）",
                        "name": "types",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "需要登入\" example({\"state\":1,\"code\":1})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/pickprog": {
            "get": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "透過 Bookmarklet 新增 YouTube 影片到未分類頻道（支援 JSONP），同時支援 youtube_id 和 url 參數",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "節目"
                ],
                "summary": "Pick 節目（Bookmarklet）",
                "parameters": [
                    {
                        "type": "string",
                        "description": "JSONP callback 函數名",
                        "name": "callback",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "影片名稱",
                        "name": "name",
                        "in": "query",
                        "required": true
                    },
                    {
                        "type": "string",
                        "description": "YouTube 影片 ID（文件規範）",
                        "name": "youtube_id",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "YouTube URL（向後相容，與 youtube_id 二選一）",
                        "name": "url",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "描述",
                        "name": "desc",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "時長（秒）",
                        "name": "duration",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "標籤（逗號分隔的數字）",
                        "name": "tags",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "需要登入或參數無效"
                    }
                }
            }
        },
        "/apis/prog/saveorder": {
            "post": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "儲存節目在頻道中的自訂排序（需登入，需有權限）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "節目"
                ],
                "summary": "儲存節目順序",
                "parameters": [
                    {
                        "description": "儲存節目順序請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.SaveProgramOrderRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "權限不足\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/progmoveto": {
            "post": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "將節目從一個頻道搬到另一個頻道（需登入，需有來源和目標頻道權限）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "節目"
                ],
                "summary": "移動節目",
                "parameters": [
                    {
                        "description": "移動節目請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.MoveProgramRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "權限不足\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/reset_password": {
            "post": {
                "description": "使用 access_key 重設密碼（不需要登入）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "認證"
                ],
                "summary": "重設密碼",
                "parameters": [
                    {
                        "description": "重設密碼請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.ResetPasswordRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "缺少欄位\" example({\"state\":1,\"code\":0})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/savechannel": {
            "post": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "更新頻道名稱、描述和標籤（需登入，需有權限）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "頻道"
                ],
                "summary": "儲存頻道",
                "parameters": [
                    {
                        "description": "儲存頻道請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.SaveChannelRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "權限不足\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/saveprog": {
            "post": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "更新節目內容（需登入，需有權限）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "節目"
                ],
                "summary": "儲存節目",
                "parameters": [
                    {
                        "description": "儲存節目請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.SaveProgramRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "權限不足\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/setchannelowner": {
            "post": {
                "security": [
                    {
                        "ApiAuth": []
                    }
                ],
                "description": "新增共用者，呼叫者需為 admin（優先使用 email 參數）",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "頻道"
                ],
                "summary": "設定頻道擁有者",
                "parameters": [
                    {
                        "description": "設定頻道擁有者請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.SetChannelOwnerRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "權限不足\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/signin": {
            "post": {
                "description": "使用者登入，成功後會設定 Session Cookie",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "認證"
                ],
                "summary": "登入",
                "parameters": [
                    {
                        "description": "登入請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.SignInRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "失敗回應\" example({\"state\":0,\"ret\":false})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/apis/signout": {
            "get": {
                "description": "使用者登出，清除 Session。可選的 redirect 參數會執行 HTTP redirect",
                "tags": [
                    "認證"
                ],
                "summary": "登出",
                "parameters": [
                    {
                        "type": "string",
                        "description": "重定向 URL（選填）",
                        "name": "redirect",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "成功回應（無 redirect 時）\" example({\"state\":0})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    },
                    "302": {
                        "description": "重定向到指定 URL 或首頁"
                    }
                }
            }
        },
        "/apis/signup": {
            "post": {
                "description": "新使用者註冊，需要有效的邀請碼",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "認證"
                ],
                "summary": "註冊",
                "parameters": [
                    {
                        "description": "註冊請求",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.SignUpRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "失敗回應\" example({\"state\":1,\"code\":2})",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/health": {
            "get": {
                "description": "檢查伺服器和資料庫連線狀態（支援 MongoDB 和 SQLite）",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "系統"
                ],
                "summary": "健康檢查",
                "responses": {
                    "200": {
                        "description": "服務正常",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        },
        "/ready": {
            "get": {
                "description": "檢查服務是否準備好接受請求（包含資料庫查詢測試，支援 MongoDB 和 SQLite）",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "系統"
                ],
                "summary": "就緒檢查",
                "responses": {
                    "200": {
                        "description": "服務就緒",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "handlers.AddChannelRequest": {
            "type": "object",
            "required": [
                "name"
            ],
            "properties": {
                "name": {
                    "description": "頻道名稱",
                    "type": "string",
                    "example": "我的頻道"
                },
                "tags": {
                    "description": "標籤列表",
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                }
            }
        },
        "handlers.AddProgramRequest": {
            "type": "object",
            "required": [
                "ch",
                "name",
                "youtube_id"
            ],
            "properties": {
                "ch": {
                    "description": "頻道 ID",
                    "type": "string",
                    "example": "channel_id"
                },
                "desc": {
                    "description": "節目描述",
                    "type": "string",
                    "example": "節目描述"
                },
                "duration": {
                    "description": "時長（秒）",
                    "type": "integer",
                    "example": 300
                },
                "name": {
                    "description": "節目名稱",
                    "type": "string",
                    "example": "節目名稱"
                },
                "tags": {
                    "description": "標籤列表",
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                },
                "updateCover": {
                    "description": "是否更新頻道封面",
                    "type": "boolean",
                    "example": false
                },
                "youtube_id": {
                    "description": "YouTube 影片 ID",
                    "type": "string",
                    "example": "dQw4w9WgXcQ"
                }
            }
        },
        "handlers.ChangePasswordRequest": {
            "type": "object",
            "required": [
                "new_password",
                "password"
            ],
            "properties": {
                "new_password": {
                    "type": "string"
                },
                "password": {
                    "type": "string"
                }
            }
        },
        "handlers.DeleteProgramRequest": {
            "type": "object",
            "required": [
                "ch",
                "ids"
            ],
            "properties": {
                "ch": {
                    "type": "string"
                },
                "ids": {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                }
            }
        },
        "handlers.ForgetPasswordRequest": {
            "type": "object",
            "required": [
                "email"
            ],
            "properties": {
                "email": {
                    "type": "string"
                }
            }
        },
        "handlers.MoveProgramRequest": {
            "type": "object",
            "required": [
                "ch",
                "ids",
                "target"
            ],
            "properties": {
                "ch": {
                    "type": "string"
                },
                "ids": {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                },
                "target": {
                    "type": "string"
                }
            }
        },
        "handlers.ResetPasswordRequest": {
            "type": "object",
            "required": [
                "access_key",
                "email",
                "password"
            ],
            "properties": {
                "access_key": {
                    "type": "string"
                },
                "email": {
                    "type": "string"
                },
                "password": {
                    "type": "string"
                }
            }
        },
        "handlers.SaveChannelRequest": {
            "type": "object",
            "required": [
                "id",
                "name"
            ],
            "properties": {
                "desc": {
                    "type": "string"
                },
                "id": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                }
            }
        },
        "handlers.SaveProgramOrderRequest": {
            "type": "object",
            "required": [
                "ch",
                "order"
            ],
            "properties": {
                "ch": {
                    "type": "string"
                },
                "order": {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                }
            }
        },
        "handlers.SaveProgramRequest": {
            "type": "object",
            "required": [
                "ch",
                "name",
                "prog_id",
                "youtube_id"
            ],
            "properties": {
                "ch": {
                    "type": "string"
                },
                "desc": {
                    "type": "string"
                },
                "duration": {
                    "type": "integer"
                },
                "name": {
                    "type": "string"
                },
                "prog_id": {
                    "type": "integer"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                },
                "updateCover": {
                    "type": "boolean"
                },
                "youtube_id": {
                    "type": "string"
                }
            }
        },
        "handlers.SetChannelOwnerRequest": {
            "type": "object",
            "required": [
                "id"
            ],
            "properties": {
                "c": {
                    "description": "頻道 ID（歷史遺留參數，與 id 相同）",
                    "type": "string"
                },
                "email": {
                    "description": "要新增為共用者的使用者 Email（優先使用）",
                    "type": "string"
                },
                "id": {
                    "description": "頻道 ID",
                    "type": "string"
                },
                "owners": {
                    "description": "要新增的使用者 ID 陣列（向後相容）",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "handlers.SignInRequest": {
            "type": "object",
            "required": [
                "password",
                "username"
            ],
            "properties": {
                "password": {
                    "description": "密碼",
                    "type": "string",
                    "example": "password123"
                },
                "username": {
                    "description": "使用者名稱",
                    "type": "string",
                    "example": "testuser"
                }
            }
        },
        "handlers.SignUpRequest": {
            "type": "object",
            "required": [
                "email",
                "invitation_code",
                "password",
                "username"
            ],
            "properties": {
                "email": {
                    "description": "電子郵件",
                    "type": "string",
                    "example": "test@example.com"
                },
                "invitation_code": {
                    "description": "邀請碼",
                    "type": "string",
                    "example": "sixpens"
                },
                "password": {
                    "description": "密碼",
                    "type": "string",
                    "example": "password123"
                },
                "username": {
                    "description": "使用者名稱",
                    "type": "string",
                    "example": "testuser"
                }
            }
        }
    }
}